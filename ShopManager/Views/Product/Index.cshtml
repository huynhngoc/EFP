
@{
    ViewBag.Title = "ManageProduct";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section CustomCSS { 
    <!-- DataTables -->  
    @Styles.Render("~/DataTable-CSS")
    <!-- summernote -->
    @Styles.Render("~/SummerNote-CSS")

    <!-- tokenfield -->
    @Styles.Render("~/tokenfield-CSS")

    <!-- switcher -->
    @Styles.Render("~/Switchery-CSS")

    <!-- carousel -->
    @Styles.Render("~/slick-carousel-CSS")

    <!-- croper -->
    @Styles.Render("~/Image-cropper-CSS")
}



    <!-- content here -->
    <!-- grid here -->
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    @*<h5>Nhóm các sản phẩm</h5>*@
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>                                                                        
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="table-responsive">                        
                        <table class="table table-bordered table-hover product-master">
                            <thead>
                                <tr>                                    
                                    <th>Id</th>
                                    <th><input type='checkbox'></th>
                                    <th>Tên</th>
                                    <th>Phân loại</th>
                                    <th>Mô tả</th>
                                    <th>Trạng thái</th>
                                    <th>#</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- end grid -->
        <!-- grid here -->

        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <input type="text" class="form-control input-sm m-b-xs" id="detailed_filter"
                           placeholder="Tìm kiếm">
                    @*<table id="t1" class="footable table table-stripped product-detail" data-page-size="15" data-filter=#detailed_filter>
                        <thead>
                            <tr>
                                <th>Đặc điểm</th>
                                <th>Giá</th>
                                <th>Trạng thái</th>
                                <th class="text-right" data-sort-ignore="true">#</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Màu xanh đen, size 32</td>
                                <td>240000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu xanh đen, size 34</td>
                                <td>240000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu xanh đen, size 36</td>
                                <td>240000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu đỏ, size 32</td>
                                <td>240000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu đỏ, size 38</td>
                                <td>240000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6">
                                    <ul class="pagination pull-right"></ul>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                    <table id="t2" class="footable table table-stripped product-detail" data-page-size="15" data-filter=#detailed_filter>
                        <thead>
                            <tr>
                                <th>Đặc điểm</th>
                                <th>Giá</th>
                                <th>Trạng thái</th>
                                <th class="text-right" data-sort-ignore="true">#</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Màu xanh đen, size 32</td>
                                <td>280000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu xanh đen, size 34</td>
                                <td>280000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu xanh đen, size 36</td>
                                <td>280000 đồng</td>
                                <td><span class="label label-danger">Hết hàng</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu đỏ, size 32</td>
                                <td>280000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Màu đỏ, size 38</td>
                                <td>280000 đồng</td>
                                <td><span class="label label-primary">Bình thường</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn-white btn btn-xs"
                                                data-toggle="modal" data-target="#viewDetailModal">
                                            Sửa
                                        </button>
                                        <button class="btn-white btn btn-xs">Xóa</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6">
                                    <ul class="pagination pull-right"></ul>
                                </td>
                            </tr>
                        </tfoot>
                    </table>*@
                </div>
            </div>
        </div>
        <!-- end grid -->
    </div>
        <!-- modal -->
        <div class="modal inmodal" id="viewProductModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content animated bounceInRight">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Thông tin sản phẩm</h4>
                        <small class="font-bold">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>
                    </div>
                    <div class="modal-body">
                        <div class="tabs-container">
                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#tab-1"> Thông tin chung</a></li>
                                <li class=""><a data-toggle="tab" href="#tab-2"> Hình ảnh</a></li>
                            </ul>
                            <div class="tab-content">
                                <div id="tab-1" class="tab-pane active">
                                    <div class="panel-body">
                                        <fieldset class="form-horizontal">
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Tên:</label>
                                                <div class="col-sm-10"><input type="text" class="form-control" placeholder="Tên sản phẩm"></div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Phân loại:</label>
                                                <div class="col-sm-10">
                                                    <select class="form-control">
                                                        <option></option>
                                                        <option value="0">Bahamas</option>
                                                        <option value="1">Bahrain</option>
                                                        <option value="2">Bangladesh</option>
                                                        <option value="3">Barbados</option>
                                                        <option value="4">Belarus</option>
                                                        <option value="5">Belgium</option>
                                                        <option value="6">Belize</option>
                                                        <option value="7">Benin</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Mô tả:</label>
                                                <div class="col-sm-10">
                                                    <div class="summernote" id="#summernote">
                                                        <h3>Giày viết ở đây</h3>
                                                        dummy text of the printing and typesetting industry. <strong>Lorem Ipsum has been the industry's</strong> standard dummy text ever since the 1500s,
                                                        when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic
                                                        when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic
                                                        typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with
                                                        <br />

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Đặc điểm:</label>
                                                <div class="col-sm-10 input-group">
                                                    <input type="text" class="form-control" placeholder="màu, size ..." width="20px">
                                                    <span class="input-group-btn" style="width:0px"></span>
                                                    <input type="text" class="form-control"
                                                           placeholder="(màu) đỏ, xanh ..." id="tokenfield" />
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-secondary" type="button"><span class="fa fa-trash-o"></span></button>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Tình trạng:</label>
                                                <div class="col-sm-10">
                                                    <input type="checkbox" class="js-switch" id="masterProStatus" checked />
                                                    <span class="label label-primary" id="masterStatusOn">Bình thường</span>
                                                    <span class="label label-danger" id="masterStatusOff" style="display:none">Ngưng bán</span>
                                                </div>
                                            </div>

                                        </fieldset>
                                    </div>
                                </div>
                                <div id="tab-2" class="tab-pane active">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="product-images">
                                                    <div>
                                                        <div class="image-imitation">
                                                            [IMAGE 1]
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div class="image-imitation">
                                                            [IMAGE 2]
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div class="image-imitation">
                                                            [IMAGE 3]
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="image-crop">
                                                            <img src="img/p3.jpg">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <h4>Xem trước</h4>
                                                        <div class="img-preview img-preview-sm"></div>
                                                        <div class="btn-group">
                                                            <label title="Upload image file" for="inputImage" class="btn btn-primary">
                                                                <input type="file" accept="image/*" name="file" id="inputImage" class="hide">
                                                                Upload new image
                                                            </label>
                                                            <label title="Donload image" id="download" class="btn btn-primary">Download</label>
                                                        </div>

                                                        <div class="btn-group">
                                                            <button class="btn btn-white" id="zoomIn" type="button">Zoom In</button>
                                                            <button class="btn btn-white" id="zoomOut" type="button">Zoom Out</button>
                                                            <button class="btn btn-white" id="rotateLeft" type="button">Rotate Left</button>
                                                            <button class="btn btn-white" id="rotateRight" type="button">Rotate Right</button>
                                                            <button class="btn btn-warning" id="setDrag" type="button">New crop</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Đóng</button>
                        <button type="button" class="btn btn-primary">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- end modal -->
        <!-- modal -->
        <div class="modal inmodal" id="viewDetailModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated bounceInRight">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Thông tin sản phẩm</h4>
                        <small class="font-bold">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>
                    </div>
                    <div class="modal-body">
                        <div class="panel-body">
                            <fieldset class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Tên:</label>
                                    <div class="col-sm-10"><input type="text" readonly="true" class="form-control" placeholder="Tên sản phẩm" value="Giày bata nam, màu xanh đen, size 32"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Giá:</label>
                                    <div class="col-sm-10"><input type="text" class="form-control" placeholder="$160.00" value="2000000"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Tình trạng:</label>
                                    <div class="col-sm-10">
                                        <input type="checkbox" class="js-switch" id="detailProStatus" checked />
                                        <span class="label label-primary" id="detailStatusOn">Bình thường</span>
                                        <span class="label label-danger" id="detailStatusOff" style="display:none">Hết hàng</span>
                                    </div>
                                </div>

                            </fieldset>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Đóng</button>
                        <button type="button" class="btn btn-primary">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- end modal -->



    <!--end content-->
    @section CustomJS {    

    <!-- DataTables -->
    @Scripts.Render("~/DataTable-JS")    
    <!-- SUMMERNOTE -->
    @Scripts.Render("~/SummerNote-JS")

    <!-- tokenfield-->
    @Scripts.Render("~/tokenfield-JS")

    <!-- Switchery -->
    @Scripts.Render("~/Switchery-JS")

    <!-- slick carousel-->
    @Scripts.Render("~/slick-carousel-JS")

    <!-- Image cropper -->
    @Scripts.Render("~/Image-cropper-JS")
    <script>
        var s;
        var table;
        var currentChildren;
        $(document).ready(function () {
            var languageConfig = {
                "oPaginate": {
                    "sNext": "Tiếp"
                    , "sLast": "Cuối"
                    , "sPrevious": "Trước"
                    , "sFirst": "Đầu"
                }
                        , "sInfo": "Kết quả từ _START_ đến _END_ trong số _TOTAL_"
                        , "sInfoThousands": "."
                        , "sLoadingRecords": "Đang tải ..."
                        , "sProcessing": "Đang xử lý ..."
                        , "sSearch": "Tìm kiếm:"
                        , "sZeroRecords": "Không tìm thấy kết quả"
            }
            var productTable;
            //$(window).on("resize",function () {
            //    $(".product-master").resize();
            //});
            $('.dataTables-example').DataTable({
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    { extend: 'copy' },
                    { extend: 'csv' },
                    { extend: 'excel', title: 'ExampleFile' },
                    { extend: 'pdf', title: 'ExampleFile' },

                    {
                        extend: 'print',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                        }
                    }
                ]

            });

            productTable = $(".product-master").dataTable({
                "bProcessing": true
                , "bServerSide": true
                , "sAjaxSource": "../Product/GetMasterProduct"
                , "fnServerParams": function (aoData) {
                    aoData.push({ "name": "shopId", "value": "2" });
                }
                , "fnInitComplete": function (oSettings, json) {
                    $(".product-master").removeAttr("style");
                    $(".product-master thead tr").addClass("info");
                    //$(".product-master tbody tr").addClass("success");
                }
                , "aoColumnDefs": [
                          { "bSortable": false
                            , "aTargets": [1]
                            , "mData": "null"
                            , "sDefaultContent": "<input type='checkbox'>"
                            //, "sTitle": "<input type='checkbox'>"
                          }
                        , { "bVisible": false, "aTargets": [0], "mData": "Id" }
                        , { "aTargets": [2], "mData": "Name" }
                        , { "aTargets": [3], "mData": "Category[1]" }
                        , { "aTargets": [4], "mData": "Description" }
                        , {
                            "bSortable": false
                            , "aTargets": [-1]
                            , "sDefaultContent": '<div class="btn-group"><button class="btn btn-success" type="button" title="Chi tiết" data-toggle="modal" data-target="#viewProductModal"><i class="fa fa-edit"></i></button><button class="btn btn-danger" type="button" title="Xóa"><i class="fa fa-trash"></i></button><button class="btn btn-info view-detail" title="Xem nhanh" type="button"><i class="fa fa-arrows-v"></i></button></div>'
                            , "mData": "null"
                        }
                        , {
                            "mData": function (source) {
                                //console.log(source);
                                var status = source.Status;
                                if (status == true) {
                                    return '<span class="label label-primary">Bình thường</span>';
                                } else {
                                    return '<span class="label label-danger">Ngưng bán</span>';
                                }
                            }
                            , "aTargets": [5]
                        }
                ]
                , "oLanguage": languageConfig
                , "iDisplayLength": 25
                //, "aLengthMenu": [5, 10, 25]
                , "bLengthChange": false
            });            
            
            table = productTable;            
            /* setting show detailed product*/            
            $('.product-master').on('click', '.view-detail', function (evt) {
                //var id = productTable.DataTable().row($(this)).data()[4];
                var clickedRow = $(this).closest("tr");
                var id = productTable.fnGetData($(clickedRow)).Id;
                console.log(id);
                //$('.product-detail').hide();
                //$(id).show();
                //$(currentChildren).remove();
                $('.product-info').remove();
                if (productTable.fnIsOpen(clickedRow)) {
                    productTable.fnClose(clickedRow);
                } else {
                    productTable.fnOpen(clickedRow, '<div class="table-responsive"><table class="table table-bordered table-hover product-detail"><thead><tr><th></th><th></th><th>Đặc điểm</th><th>Giá riêng</th><th>Giá khuyến mãi</th><th>Tình trạng</th><th>#</th></tr></thead></table></div>'
                                    , "product-info");
                    currentChildren = $(".product-detail").dataTable({
                        "bProcessing": true
                    , "bServerSide": true
                    , "sAjaxSource": "http://localhost:26638/Product/GetDetailedProduct"
                    , "fnServerParams": function (aoData) {                        
                        aoData.push({ "name": "masterId", "value": id });
                    }
                    , "aoColumnDefs": [                        
                              { "bVisible": false, "aTargets": [0], "mData": "Id" }
                            , {
                                "bSortable": false
                                , "aTargets": [1]
                                , "mData": "null"
                                , "sDefaultContent": "<input type='checkbox'>"                                
                              }
                            , {
                                "aTargets": [2]
                                , "mData": "Properties"
                            }
                            , { "aTargets": [3], "mData": "Price"                                
                            }
                            , {
                                "aTargets": [4], "mData": "PromotionPrice"                                
                              }
                            , {
                                "mData": function (source) {
                                    //console.log(source);
                                    var status = source.Status;
                                    if (status == true) {
                                        return '<span class="label label-primary">Còn hàng</span>';
                                    } else {
                                        return '<span class="label label-danger">Hết hàng</span>';
                                    }
                                }
                                , "aTargets": [5]                                
                            }
                            , {
                                "bSortable": false
                                , "aTargets": [-1]
                                , "sDefaultContent": '<div class="btn-group"><button class="btn btn-success" type="button" title="Chi tiết" data-toggle="modal" data-target="#viewProductModal"><i class="fa fa-edit"></i></button><button class="btn btn-danger" type="button" title="Xóa"><i class="fa fa-trash"></i></button></div>'
                                , "mData": "null"
                            }                            
                    ]
                    , "oLanguage": languageConfig
                    , "iDisplayLength": 5                                    
                    , "bLengthChange": false

                    });
                    

                    
                }
            });

            
            /* set description input */
            $(".summernote").summernote({
                //toolbar:["style",["bold", "italic", "underline", "clear"]]
            });


            /*tokenfield*/
            $('#tokenfield').tokenfield();

            /* switcher*/
            var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));
            elems.forEach(function(html) {
              var switchery = new Switchery(html);
            });

            $("#masterProStatus").on("change", function(){
                if ($("#masterProStatus").is(":checked")){
                    $("#masterStatusOn").show();
                    $("#masterStatusOff").hide();
                } else {
                    $("#masterStatusOn").hide();
                    $("#masterStatusOff").show();
                }
            });

            $("#detailProStatus").on("change", function(){
                if ($("#detailProStatus").is(":checked")){
                    $("#detailStatusOn").show();
                    $("#detailStatusOff").hide();
                } else {
                    $("#detailStatusOn").hide();
                    $("#detailStatusOff").show();
                }
            });

            /* image carousel*/
            $('.product-images').slick({
                dots: true
            });

            /* image cropper*/
            var $image = $(".image-crop > img")
            $($image).cropper({
                aspectRatio: 1.618,
                preview: ".img-preview",
                done: function(data) {
                    // Output the result data for cropping image.
                }
            });

            var $inputImage = $("#inputImage");
            if (window.FileReader) {
                $inputImage.change(function() {
                    var fileReader = new FileReader(),
                            files = this.files,
                            file;

                    if (!files.length) {
                        return;
                    }

                    file = files[0];

                    if (/^image\/\w+$/.test(file.type)) {
                        fileReader.readAsDataURL(file);
                        fileReader.onload = function () {
                            $inputImage.val("");
                            $image.cropper("reset", true).cropper("replace", this.result);
                        };
                    } else {
                        showMessage("Please choose an image file.");
                    }
                });
            } else {
                $inputImage.addClass("hide");
            }

            $("#download").click(function() {
                window.open($image.cropper("getDataURL"));
            });

            $("#zoomIn").click(function() {
                $image.cropper("zoom", 0.1);
            });

            $("#zoomOut").click(function() {
                $image.cropper("zoom", -0.1);
            });

            $("#rotateLeft").click(function() {
                $image.cropper("rotate", 45);
            });

            $("#rotateRight").click(function() {
                $image.cropper("rotate", -45);
            });

            $("#setDrag").click(function() {
                $image.cropper("setDragMode", "crop");
            });

        });

    </script>
        }